webpackJsonp([2],{Pv68:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("lC5x"),o=n.n(a),r=n("J0Oq"),s=n.n(r),i=n("4YfN"),c=n.n(i),l=n("KOga"),u=(n("i84Q"),n("yclV"),n("9rMa")),p={name:"login",data:function(){return{loginForm:{username:"",password:"",captcha:""},tips:"",loading:!1,pwdType:"password",imgUrl:"",loginRules:{username:[{validator:function(t,e,n){e?n():n(new Error("用户名不能为空！"))},trigger:"blur"}],password:[{validator:function(t,e,n){e?n():n(new Error("密码不能为空"))},trigger:"blur"}],captcha:[{validator:function(t,e,n){e?n():n(new Error("验证码不能为空"))},trigger:"blur"}]}}},created:function(){this.captchaData()},methods:c()({showPwd:function(){"password"===this.pwdType?this.pwdType="":this.pwdType="password"},captchaData:function(){var t=this;return s()(o.a.mark(function e(){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.g+"/sysUser/createImg",e.next=3,Object(l.b)(n,{},"get","application/x-www-form-urlencoded",!0);case 3:t.imgUrl=e.sent,t.imgUrl=t.imgUrl+"?t="+(new Date).getTime();case 5:case"end":return e.stop()}},e,t)}))()},handleLogin:function(){var t=this;this.$refs.loginForm.validate(function(e){if(!e)return t.tips="",!1;t.loading=!0,t.toLogin()})},toLogin:function(){var t=this;return s()(o.a.mark(function e(){var n,a,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.g+"/sysUser/login",a={username:t.loginForm.username,password:t.loginForm.password,imgCode:t.loginForm.captcha},e.next=4,Object(l.b)(n,a,"post","application/x-www-form-urlencoded");case 4:200==(r=e.sent).code?(sessionStorage.setItem("username",t.loginForm.username),sessionStorage.setItem("shopId",r.data.shopId),sessionStorage.setItem("token",r.data.token),t.loading=!1,t.getNavListData(),t.$router.push({path:"/"})):(t.loginForm.captcha="",t.loading=!1,t.captchaData(),t.$message.error(r.message?r.message:"网络错误，请稍后重试！"));case 6:case"end":return e.stop()}},e,t)}))()}},Object(u.b)(["PERMISSIONS","NAVLIST"]),{getNavListData:function(){var t=this;return s()(o.a.mark(function e(){var a,r,s,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.g+"/sysUser/selectTreeMenusByUsername",r={username:t.loginForm.username},e.next=4,Object(l.b)(a,r,"post");case 4:200==(s=e.sent).code?(localStorage.setItem("per",s.data.join(",")+","),t.PERMISSIONS(s.data.join(",")),i=[],c=[],s.data.forEach(function(t){var e={},a=[];e.icon=t.icon,e.index=String(t.menuId),e.name=t.name,e.isValid=t.isValid,t.children.forEach(function(t){t.index=t.url,a.push(t)}),e.children=a,i.push(e),t.children.forEach(function(t){var e={};e.path=t.url,e.component=function(e){return n.e(6).then(function(){var a=[n("T6VX")("./page"+t.url+".vue")];e.apply(null,a)}.bind(this)).catch(n.oe)},e.meta={title:t.name},c.push(e)})}),t.$router.options.routes[2].children=c,t.$router.options.routes.length<4&&t.$router.options.routes.push({path:"*",redirect:"/404"}),t.$router.addRoutes(t.$router.options.routes),t.NAVLIST(i)):t.$message({type:"warning",message:s.msg,duration:1500});case 6:case"end":return e.stop()}},e,t)}))()}})},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login-container"},[n("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{autoComplete:"on",model:t.loginForm,rules:t.loginRules,"status-icon":"","label-position":"left"}},[n("h3",{staticClass:"title"},[t._v("水果商城后台管理系统")]),t._v(" "),n("el-form-item",{attrs:{prop:"username"}},[n("span",{staticClass:"svg-container svg-container_login"},[n("i",{staticClass:"iconfont icon-yonghu"})]),t._v(" "),n("el-input",{attrs:{name:"username",type:"text",autoComplete:"on",placeholder:"请输入账号"},model:{value:t.loginForm.username,callback:function(e){t.$set(t.loginForm,"username",e)},expression:"loginForm.username"}})],1),t._v(" "),n("el-form-item",{attrs:{prop:"password"}},[n("span",{staticClass:"svg-container"},[n("i",{staticClass:"iconfont icon-mima"})]),t._v(" "),n("el-input",{attrs:{name:"password",type:t.pwdType,autoComplete:"on",placeholder:"请输入密码"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleLogin(e):null}},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}}),t._v(" "),n("span",{staticClass:"show-pwd",on:{click:t.showPwd}},[n("i",{staticClass:"iconfont",class:"password"===t.pwdType?"icon-eye-off":"icon-eye"})])],1),t._v(" "),n("el-form-item",{staticClass:"f_r",attrs:{prop:"captcha"}},[n("span",{staticClass:"svg-container"},[n("i",{staticClass:"iconfont icon-yanzhengma"})]),t._v(" "),n("el-input",{attrs:{name:"captcha",type:"text",placeholder:"请输入验证码"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleLogin(e):null}},model:{value:t.loginForm.captcha,callback:function(e){t.$set(t.loginForm,"captcha",e)},expression:"loginForm.captcha"}}),t._v(" "),n("img",{staticClass:"verification",attrs:{src:t.imgUrl,alt:"看不清楚？点击图片刷新!"},on:{click:t.captchaData}}),t._v(" "),n("span",{staticClass:"refresh",on:{click:t.captchaData}},[n("i",{staticClass:"el-icon-refresh"})]),t._v(" "),t.tips.length>0?n("div",{staticClass:"el-form-item__error"},[t._v("\n\t\t\t\t"+t._s(t.tips)+"\n\t\t\t")]):t._e()],1),t._v(" "),n("el-form-item",[n("el-button",{staticClass:"btn",attrs:{type:"primary",loading:t.loading},nativeOn:{click:function(e){return e.preventDefault(),t.handleLogin(e)}}},[t._v("\n\t\t\t\t登录\n\t\t\t")])],1)],1)],1)},staticRenderFns:[]};var d=n("C7Lr")(p,m,!1,function(t){n("Wbuq"),n("oS5Y")},"data-v-41b390ef",null);e.default=d.exports},Wbuq:function(t,e){},oS5Y:function(t,e){}});